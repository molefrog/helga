<html>
	<head>
		<title>Kaja</title>
		<style type="text/css">
			html, body {
				background: #343434;
				margin: 0;
			}
		</style>
	</head>
	<body>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
		<script type="text/javascript" src="http://soulwire.github.com/sketch.js/js/sketch.js"></script>

		<script type="text/javascript" src="cannon.js"></script>

		<script  type="text/javascript" src="http://auduno.github.com/headtrackr/examples/js/headtrackr.js"></script>

		<canvas id="inputCanvas" width="320" height="240" style="display:none;position: absolute;"></canvas>

		<video id="inputVideo" autoplay loop style="position:absolute; 
			-moz-transform: scaleX(-1);
        	-o-transform: scaleX(-1);
        	-webkit-transform: scaleX(-1);
        	transform: scaleX(-1);
        	filter: FlipH;"></video>
		<canvas id="overlay" width="320" height="240"  style="position:absolute; z-index : 2"></canvas>

		<script type="text/javascript">
		$(function() {
			var videoInput  = $('#inputVideo')[0];
			var canvasInput = $('#inputCanvas')[0];

			var canvasOverlay = $('#overlay')[0];
			var overlayContext = canvasOverlay.getContext('2d');

			var htracker = new headtrackr.Tracker({
				 ui : false, 
				 headPosition : true, 
				 detectionInterval : 20, 
				 smoothing : false
			});

			htracker.init(videoInput, canvasInput);
			htracker.start();

			document.addEventListener("facetrackingEvent", function( event ) {
				if (event.detection == "CS") {
					window.point_x = (320 - event.x ) / 320;
					window.point_y = (240 - event.y ) / 240;
					
					overlayContext.save();
					overlayContext.clearRect(0,0,320,240);
					overlayContext.translate(window.point_x * 320, window.point_y * 240);
					overlayContext.strokeStyle = "#00CC00";
					overlayContext.strokeRect(10, 10, 20, 20);
					overlayContext.restore();
				}
			});
		});

		</script>

		<script type="text/javascript">

			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-38514762-1']);
			  _gaq.push(['_trackPageview']);

			  (function() {
			    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();

		</script>
	</body>
</html>